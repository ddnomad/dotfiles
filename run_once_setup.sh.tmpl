{{- if eq .chezmoi.os "linux" -}}

#!/usr/bin/env bash
set -euo pipefail

###############################################################################
# Step 1: Installing Paru (AUR helper)
###############################################################################
sudo pacman -Sy

if ! command -v paru &> /dev/null; then
    dir_path="/tmp/$(date +%s)-paru"
    git clone https://aur.archlinux.org/paru.git "${dir_path}"
    cd "${dir_path}" && makepkg -si; cd - && rm -rf "${dir_path}"
fi

###############################################################################
# Step 2: Installing packages
###############################################################################
paru -S \
    alacritty \
    alsa-utils \
    base-devel \
    bash-completion \
    bumblebee-status \
    chezmoi \
    dmenu \
    dnsutils \
    eslint \
    feh \
    firefox \
    flake8 \
    glances \
    hadolint-bin \
    i3-gaps \
    i3lockr-bin \
    inetutils \
    jq \
    lua \
    luacheck \
    make \
    man \
    neovim \
    nerd-fonts-hack \
    openssh \
    picom \
    python-flake8-docstrings \
    python-pycodestyle \
    python-pydocstyle \
    python-pylint \
    rsync \
    ruby-sqlint \
    shellcheck \
    standard \
    tmux \
    tree \
    unclutter-xfixes-git \
    xf86-video-intel \
    xorg-server \
    xorg-xinit \
    xorg-xprop \
    yarn

{{ if eq .host.chassis_type "vm" }}
if ! command -v vmware-user-suid-wrapper &> /dev/null; then
    sudo pacman -S \
        gtkmm3 \
        mesa \
        open-vm-tools \
        xf86-input-vmmouse \
        xf86-video-vmware

    sudo systemctl enable vmtoolsd.service
    sudo systemctl enable vmware-vmblock-fuse.service

    echo '---(!) WARNING: Add the following modules to /etc/mkinitcpio.conf and'
    echo '---(!) WARNING: run "mkinitcpio -p linux" to regenerate initramfs'
    echo 'vsock vmw_vsock_vmci_transport vmw_balloon vmw_pvscsi vmw_vmci vmwgfx vmxnet3'
fi
{{ end }}

###############################################################################
# Step 3: Creating directories
###############################################################################
mkdir -p ~/casino
mkdir -p ~/development
mkdir -p ~/notes
mkdir -p ~/pictures/screenshots

{{ if eq .host.chassis_type "laptop" }}
mkdir -p ~/documents
mkdir -p ~/downloads
mkdir -p ~/music
mkdir -p ~/videos
{{ end }}

{{ if eq .host.chassis_type "vm" }}
mkdir -p ~/scratch
{{ end }}


{{- else if eq .chezmoi.os "darwin" -}}

#!/usr/bin/env zsh
set -euo pipefail

echo '---(X) ERROR: Not implemented yet' >&2
exit 1

{{- end }}

git config --global user.email "{{ .user.email }}"
git config --global user.name "{{ .user.name }}"
